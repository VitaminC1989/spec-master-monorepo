**周耀管理系统 V4**

好的，这是为您整理好的最新版产品需求文档。

本版本基于 V1.4 进行了精简和梳理，核心变更是将配料明细的“规格”字段从单一文本升级为结构化的子列表（L4），以支持不同尺码对应不同规格的业务场景。

**📄 产品需求文档：服装配方管理系统 (SpecMaster)**

|  |  |  |  |
|:---|:---|:---|:---|
| **文档版本** | **v1.4 (四级结构精细版)** | **日期** | 2025-11-22 |
| **核心目标** | 解决服装“一款多色”配方管理的格式混乱问题，实现数据结构化和录入高效化。 |  |  |
| **核心变更** | 将 BOM Item 中的“规格”字段从多行文本升级为结构化的子列表 (L4)。 |  |  |

**1\\ 🏗️ 核心数据结构规范 (Data Schema) v1.4**

系统数据结构升级为\*\*四级嵌套\*\*模型。

**第 1 层：款号层 (L1: Style Level) - \[公共信息\]**

**描述：** 定义一个具体的服装款式，承载所有颜色共用的信息。

**核心字段：** 款号（唯一索引）、款式名称、创建日期、公共备注。

**第 2 层：颜色版本层 (L2: Color Variant) - \[规格分类\]**

**描述：** 同一款号下的不同颜色变体。这是\*\*配料表 (BOM)\*\* 的挂载点。

**核心字段：** 款式颜色（如：灰色）、\*\*样衣图片\*\*（核心展示字段）、尺码范围。

**第 3 层：配料明细层 (L3: BOM Item) - \[物料数据\]**

**描述：** 依附于“颜色版本”的具体物料清单。

**核心变更：** 原有的“规格 (Spec)”文本字段被移除，取而代之的是一个挂载在当前记录下的 \*\*L4 规格明细列表\*\*。

**字段定义：**

|  |  |  |  |
|:---|:---|:---|:---|
| 字段名 | 数据类型 | 必填 | 详细说明 |
| **辅料名称** | 文本 | ✅ | 如 "5号树脂拉链"。 |
| **辅料图片** | 图片 | ✅ | 列表显示缩略图，点击弹窗看大图。 |
| **辅料颜色** | 复合字段 |  | 支持填写文字或上传色卡图片。UI 提供输入框和上传按钮。 |
| **单耗 (Usage)** | 数字 | ✅ | 生产一件衣服的基准消耗量。如 1。 |
| **单耗单位** | 选项 | ✅ | 下拉选择：米, 条, 粒, 套。 |
| **供应商** | 文本 |  | 记录采购来源。 |
| **(关联) 规格明细** | **L4 子列表** | ✅ | **(关键更新)** 关联到 L4 的多条规格记录。 |

**第 4 层：规格明细层 (L4: Spec Detail) - \[尺寸数据\] —— (新增层级)**

**描述：** 依附于一条 L3 配料明细，用于精确描述该配料在不同尺码下的具体规格参数。

**逻辑：** 一条 L3 配料可以对应\*\*一条或多条\*\* L4 规格明细。如果全尺码通用，则只有一条记录。

**字段定义：**

|                     |           |      |                                     |
|:--------------------|:----------|:-----|:------------------------------------|
| 字段名              | 数据类型  | 必填 | 详细说明与示例                      |
| **尺码 (Size)**     | 文本      |      | 用于区分尺码。如：S, M, L 或 通码。 |
| **规格值 (Value)**  | 文本/数字 | ✅   | 具体的规格参数。如：58.5, 2。       |
| **规格单位 (Unit)** | 文本      | ✅   | 规格值的计量单位。如：cm, mm。      |

**2\\ 📱 核心功能需求 (Functional Requirements) v1.4**

**F1. 四级视图的 UI 呈现与交互**

**界面布局：**

顶部展示 L1 款号基础信息。

中部使用 Tabs 切换 L2 颜色版本（如 \[ 灰色 \] \[ 粉色 \]）。

主体区域展示当前颜色的 L2 样衣图和 L3 配料明细表。

**L3 表格的规格展示与编辑 (关键):**

**展示模式（聚合显示）：** 在 L3 表格的“规格明细”单元格中，将关联的多条 L4 数据聚合显示为多行文本，保持表格整洁。

*展示示例：*

<table style="width:74%;">
<colgroup>
<col style="width: 73%" />
</colgroup>
<tbody>
<tr>
<td style="text-align: left;">Plain Text<br />
S: 58.5 cm<br />
M: 59.5 cm<br />
L: 60.5 cm</td>
</tr>
</tbody>
</table>

**编辑模式（弹窗编辑）：** 点击该单元格时，弹出一个对话框 (Modal)。对话框内是一个可增删改的小型表格，用于录入 L4 的 尺码、值、单位 数据。保存后聚合显示回主表格。

**F2. 智能图像处理 (Smart Image)**

**缩略图模式：** L3 表格中的“辅料图片”列限制高度，显示缩略图。

**灯箱模式：** 点击缩略图，弹出灯箱全屏查看原图。

**色卡预览：** “辅料颜色”字段若上传了图片，同样支持预览。

**F3. 颜色版本一键克隆 (Clone Variant) —— *逻辑升级***

**场景：** 快速基于一个已有的颜色版本（如灰色）创建新版本（如粉色）。

**新逻辑 (深度克隆):**

复制 L2 颜色版本信息，创建新版本。

遍历源版本下的每一条 L3 配料明细，复制并挂载到新版本下。

**关键步骤：** 立即查询并复制每一条 L3 配料下属的所有 \*\*L4 规格明细记录\*\*，并挂载到新的 L3 记录下。

> \<!-- end list --\>

*总结：实现 L2 -\\ L3 -\\ L4 的三层级联/递归复制，确保数据完整性。*

**F4. 规范化打印 (Standardized Print)**

以 L2 颜色版本为单位生成打印视图。

打印表格中的“规格明细”列需按照 F1 定义的\*\*聚合显示\*\*方式进行渲染，确保多行数据在单元格内清晰换行展示。

**3\\ 🚀 用户操作流程 (User Flow)**

**新建款号 (L1):** 输入款号、名称等基础信息。

**新建颜色 (L2):** 创建第一个颜色版本（如“灰色”），上传样衣图。

**录入配料 (L3 & L4):**

在配料表中添加一行，上传辅料图片，填写名称、单耗等 L3 信息。

点击“规格明细”单元格，在弹出的窗口中，逐行添加不同尺码对应的规格、值、单位（L4 数据）。保存关闭弹窗。

**复用数据 (深度克隆):**

点击 \[复制此版本\] 按钮，命名为新颜色（如“粉色”）。

系统自动完成 L2、L3、L4 三层数据的深度复制。

用户在新界面只需替换“样衣图”和部分辅料的“颜色”信息即可。

**打印:** 点击打印按钮，生成规范的配方单交付生产。
