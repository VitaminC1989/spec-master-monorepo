# SpecMaster Monorepo é¡¹ç›®æŠ€æœ¯æ ˆä¸æ¶æ„åˆ†æ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: SpecMaster (æœè£…é…æ–¹ç®¡ç†ç³»ç»Ÿ)  
**é¡¹ç›®ç±»å‹**: Monorepo (å•ä½“ä»“åº“)  
**ä¸šåŠ¡é¢†åŸŸ**: æœè£…åˆ¶é€ ä¸š BOMï¼ˆBill of Materialsï¼‰ç®¡ç†  
**æ ¸å¿ƒä»·å€¼**: è§£å†³"ä¸€æ¬¾å¤šè‰²"å·¥è‰ºå•ç®¡ç†ç—›ç‚¹ï¼Œå®ç°å››çº§åµŒå¥—æ•°æ®ç»“æ„çš„ç›´è§‚å±•ç¤ºä¸ç¼–è¾‘

---

## ğŸ—ï¸ Monorepo æ¶æ„

### æ¶æ„ç±»å‹
- **Monorepo ç®¡ç†å·¥å…·**: Turborepo 2.7.3
- **åŒ…ç®¡ç†å™¨**: pnpm 10.27.0 (Workspace)
- **å·¥ä½œç©ºé—´ç»“æ„**:
  ```
  spec-master-monorepo/
  â”œâ”€â”€ apps/
  â”‚   â”œâ”€â”€ api/          # åç«¯ API æœåŠ¡ (@spec/api)
  â”‚   â””â”€â”€ web/          # å‰ç«¯ Web åº”ç”¨ (@spec/web)
  â”œâ”€â”€ packages/         # å…±äº«åŒ… (é¢„ç•™ï¼Œå½“å‰æœªä½¿ç”¨)
  â”œâ”€â”€ docker-compose.yml
  â”œâ”€â”€ turbo.json        # Turborepo é…ç½®
  â””â”€â”€ pnpm-workspace.yaml
  ```

### Turborepo ä»»åŠ¡ç®¡é“
```json
{
  "build": {
    "dependsOn": ["^build"],
    "outputs": ["dist/**", ".next/**", "build/**"]
  },
  "dev": {
    "cache": false,
    "persistent": true
  },
  "lint": {}
}
```

**ç‰¹ç‚¹**:
- âœ… æ”¯æŒå¹¶è¡Œæ„å»ºå’Œç¼“å­˜ä¼˜åŒ–
- âœ… ä»»åŠ¡ä¾èµ–è‡ªåŠ¨è§£æ
- âœ… å¼€å‘æ¨¡å¼æŒä¹…åŒ–è¿è¡Œ

---

## ğŸ¯ æ ¸å¿ƒä¸šåŠ¡æ¨¡å‹

### å››çº§åµŒå¥—æ•°æ®ç»“æ„

```
L1: Style (æ¬¾å·)
  â””â”€ L2: ColorVariant (é¢œè‰²ç‰ˆæœ¬)
      â””â”€ L3: BOMItem (é…æ–™æ˜ç»†)
          â””â”€ L4: SpecDetail (è§„æ ¼æ˜ç»†)
```

**ä¸šåŠ¡è§„åˆ™**:
- ä¸€ä¸ªæ¬¾å·å¯ä»¥æœ‰å¤šä¸ªé¢œè‰²ç‰ˆæœ¬
- æ¯ä¸ªé¢œè‰²ç‰ˆæœ¬æœ‰ç‹¬ç«‹çš„é…æ–™æ¸…å• (BOM)
- æ¯ä¸ªé…æ–™é¡¹å¯ä»¥æœ‰å¤šä¸ªå°ºç è§„æ ¼
- æ”¯æŒæ·±åº¦å…‹éš†ï¼ˆå¤åˆ¶æ•´ä¸ªé¢œè‰²ç‰ˆæœ¬åŠæ‰€æœ‰å­æ•°æ®ï¼‰

---

## ğŸ”§ æŠ€æœ¯æ ˆè¯¦è§£

### 1ï¸âƒ£ åç«¯æŠ€æœ¯æ ˆ (apps/api)

#### æ ¸å¿ƒæ¡†æ¶
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **NestJS** | 11.0.1 | ä¼ä¸šçº§ Node.js æ¡†æ¶ |
| **TypeScript** | 5.7.3 | ç±»å‹ç³»ç»Ÿ |
| **Node.js** | >= 18 | è¿è¡Œæ—¶ç¯å¢ƒ |

#### æ•°æ®åº“ä¸ ORM
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **PostgreSQL** | 16 (Alpine) | å…³ç³»å‹æ•°æ®åº“ |
| **Prisma ORM** | 7.2.0 | æ•°æ®åº“ ORM |
| **@prisma/adapter-pg** | 7.2.0 | PostgreSQL é©±åŠ¨é€‚é…å™¨ |
| **pg** | 8.16.3 | PostgreSQL åŸç”Ÿé©±åŠ¨ |

**Prisma é…ç½®ç‰¹ç‚¹**:
- ä½¿ç”¨ Prisma 7 çš„é©±åŠ¨é€‚é…å™¨æ¨¡å¼
- æ”¯æŒè¿æ¥æ± ç®¡ç†
- è‡ªåŠ¨ç”Ÿæˆ TypeScript ç±»å‹
- è¿ç§»ç®¡ç† (`prisma migrate`)

#### API æ–‡æ¡£ä¸éªŒè¯
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **@nestjs/swagger** | 11.2.4 | OpenAPI/Swagger æ–‡æ¡£ |
| **class-validator** | 0.14.3 | DTO éªŒè¯ |
| **class-transformer** | 0.5.1 | æ•°æ®è½¬æ¢ |

#### æ–‡ä»¶å­˜å‚¨
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **@aws-sdk/client-s3** | 3.966.0 | AWS S3 æ–‡ä»¶ä¸Šä¼  |

#### æµ‹è¯•å·¥å…·
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Jest** | 30.0.0 | å•å…ƒæµ‹è¯•æ¡†æ¶ |
| **ts-jest** | 29.2.5 | TypeScript æ”¯æŒ |
| **supertest** | 7.0.0 | HTTP æ–­è¨€æµ‹è¯• |

#### ä»£ç è´¨é‡
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **ESLint** | 9.18.0 | ä»£ç æ£€æŸ¥ |
| **Prettier** | 3.4.2 | ä»£ç æ ¼å¼åŒ– |
| **typescript-eslint** | 8.20.0 | TypeScript ESLint è§„åˆ™ |

---

### 2ï¸âƒ£ å‰ç«¯æŠ€æœ¯æ ˆ (apps/web)

#### æ ¸å¿ƒæ¡†æ¶
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **React** | 18.2.0 | UI æ¡†æ¶ |
| **TypeScript** | 5.2.2 | ç±»å‹ç³»ç»Ÿ |
| **Vite** | 5.0.8 | æ„å»ºå·¥å…· |
| **React Router** | 6.20.1 | è·¯ç”±ç®¡ç† |

#### ä¼ä¸šçº§æ¡†æ¶
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Refine** | 4.47.1 | ä¼ä¸šçº§ CRUD æ¡†æ¶ |
| **@refinedev/antd** | 5.37.4 | Ant Design é›†æˆ |
| **@refinedev/react-router-v6** | 4.5.5 | è·¯ç”±é›†æˆ |

**Refine ç‰¹æ€§**:
- è‡ªåŠ¨åŒ– CRUD æ“ä½œ
- æ•°æ®æä¾›è€…æŠ½è±¡å±‚
- è¡¨å•çŠ¶æ€ç®¡ç†
- æƒé™æ§åˆ¶
- å›½é™…åŒ–æ”¯æŒ

#### UI ç»„ä»¶åº“
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Ant Design** | 5.12.1 | UI ç»„ä»¶åº“ |
| **@ant-design/pro-components** | 2.6.43 | é«˜çº§è¡¨æ ¼ç»„ä»¶ |
| **@ant-design/icons** | 5.2.6 | å›¾æ ‡åº“ |
| **TailwindCSS** | 3.3.6 | åŸå­åŒ– CSS |

#### å®¢æˆ·ç«¯å­˜å‚¨
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Dexie** | 4.2.1 | IndexedDB å°è£… |

**ç”¨é€”**: 
- ç¦»çº¿æ•°æ®ç¼“å­˜
- æœ¬åœ°æ•°æ®æŒä¹…åŒ–
- æå‡ç”¨æˆ·ä½“éªŒ

#### æ–‡ä»¶å¤„ç†
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **qiniu-js** | 3.4.3 | ä¸ƒç‰›äº‘ OSS ä¸Šä¼  (å‰ç«¯) |
| **qiniu** | 7.14.0 | ä¸ƒç‰›äº‘ SDK (åç«¯) |
| **ExcelJS** | 4.4.0 | Excel å¯¼å‡º |
| **file-saver** | 2.0.5 | æ–‡ä»¶ä¸‹è½½ |
| **xlsx** | 0.18.5 | Excel è§£æ |

#### å·¥å…·åº“
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **dayjs** | 1.11.10 | æ—¥æœŸå¤„ç† |
| **dotenv** | 17.2.3 | ç¯å¢ƒå˜é‡ |

---

### 3ï¸âƒ£ åŸºç¡€è®¾æ–½

#### å®¹å™¨åŒ–
```yaml
# docker-compose.yml
services:
  db:
    image: postgres:16-alpine
    container_name: spec-postgres
    ports:
      - "5432:5432"
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: 123
      POSTGRES_DB: specmaster
    volumes:
      - postgres_data:/var/lib/postgresql/data
```

**ç‰¹ç‚¹**:
- PostgreSQL 16 Alpine (è½»é‡çº§)
- æ•°æ®æŒä¹…åŒ– (Docker Volume)
- æœ¬åœ°å¼€å‘ç¯å¢ƒä¸€é”®å¯åŠ¨

---

## ğŸ—„ï¸ æ•°æ®åº“æ¶æ„

### Prisma Schema è®¾è®¡

#### æ ¸å¿ƒå®ä½“ (4çº§å±‚æ¬¡ç»“æ„)

**L1: Style (æ¬¾å·è¡¨)**
```prisma
model Style {
  id           Int      @id @default(autoincrement())
  styleNo      String   @unique @map("style_no")
  styleName    String?  @map("style_name")
  publicNote   String?  @map("public_note")
  customerId   Int?     @map("customer_id")
  customerName String?  @map("customer_name")  // åèŒƒå¼åŒ–å­—æ®µ
  
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  deletedAt    DateTime? @map("deleted_at")    // è½¯åˆ é™¤
  
  customer      Customer?      @relation(...)
  colorVariants ColorVariant[]
  
  @@map("styles")
}
```

**L2: ColorVariant (é¢œè‰²ç‰ˆæœ¬è¡¨)**
```prisma
model ColorVariant {
  id             Int      @id @default(autoincrement())
  styleId        Int      @map("style_id")
  colorName      String   @map("color_name")
  sampleImageUrl String   @map("sample_image_url")
  sizeRange      String?  @map("size_range")
  sortOrder      Int      @default(0)
  
  style    Style     @relation(..., onDelete: Cascade)
  bomItems BOMItem[]
  
  @@unique([styleId, colorName])  // åŒä¸€æ¬¾å·ä¸‹é¢œè‰²å”¯ä¸€
  @@map("color_variants")
}
```

**L3: BOMItem (é…æ–™æ˜ç»†è¡¨)**
```prisma
model BOMItem {
  id                    Int      @id @default(autoincrement())
  variantId             Int      @map("variant_id")
  materialName          String   @map("material_name")
  materialImageUrl      String?  @map("material_image_url")
  materialColorText     String?  @map("material_color_text")
  materialColorImageUrl String?  @map("material_color_image_url")
  usage                 Decimal  @db.Decimal(10, 4)
  unit                  String
  supplier              String?
  
  variant     ColorVariant @relation(..., onDelete: Cascade)
  specDetails SpecDetail[]
  
  @@map("bom_items")
}
```

**L4: SpecDetail (è§„æ ¼æ˜ç»†è¡¨)**
```prisma
model SpecDetail {
  id        Int     @id @default(autoincrement())
  bomItemId Int     @map("bom_item_id")
  size      String?
  specValue String  @map("spec_value")
  specUnit  String  @map("spec_unit")
  
  bomItem BOMItem @relation(..., onDelete: Cascade)
  
  @@unique([bomItemId, size])  // åŒä¸€é…æ–™ä¸‹å°ºç å”¯ä¸€
  @@map("spec_details")
}
```

#### è¾…åŠ©å‚è€ƒè¡¨

**Customer (å®¢æˆ·è¡¨)**
```prisma
model Customer {
  id            Int      @id @default(autoincrement())
  customerName  String   @unique @map("customer_name")
  contactPerson String?
  contactPhone  String?
  contactEmail  String?
  address       String?
  isActive      Boolean  @default(true)
  
  styles Style[]
  
  @@map("customers")
}
```

**Size (å°ºç è¡¨)** & **Unit (å•ä½è¡¨)**
```prisma
model Size {
  id        Int     @id @default(autoincrement())
  sizeCode  String  @unique
  sizeName  String
  sortOrder Int?
  isActive  Boolean @default(true)
  
  @@map("sizes")
}

model Unit {
  id        Int     @id @default(autoincrement())
  unitCode  String  @unique
  unitName  String
  unitType  String?
  isActive  Boolean @default(true)
  
  @@map("units")
}
```

### ç´¢å¼•ç­–ç•¥

**å…³é”®ç´¢å¼•**:
```sql
-- å¤–é”®ç´¢å¼• (PostgreSQL ä¸è‡ªåŠ¨åˆ›å»º)
CREATE INDEX idx_color_variants_style_id ON color_variants(style_id);
CREATE INDEX idx_bom_items_variant_id ON bom_items(variant_id);
CREATE INDEX idx_spec_details_bom_item_id ON spec_details(bom_item_id);

-- ä¸šåŠ¡æŸ¥è¯¢ç´¢å¼•
CREATE INDEX idx_styles_customer_created ON styles(customer_id, created_at DESC);

-- å…¨æ–‡æœç´¢ç´¢å¼• (pg_trgm)
CREATE INDEX idx_bom_items_material_name_gin ON bom_items 
  USING gin (material_name gin_trgm_ops);

-- éƒ¨åˆ†ç´¢å¼• (æ´»åŠ¨æ•°æ®)
CREATE INDEX idx_sizes_is_active ON sizes(is_active) 
  WHERE is_active = true;
```

**æ€§èƒ½ç›®æ ‡**:
- æ¬¾å¼åˆ—è¡¨æŸ¥è¯¢: < 50ms (10,000+ æ¬¾å¼)
- å•ä¸ªæ¬¾å¼è¯¦æƒ…: < 100ms (å®Œæ•´å››çº§)
- ç‰©æ–™æœç´¢: < 200ms (è·¨æ‰€æœ‰ BOM)
- æ·±åº¦å…‹éš†: < 500ms (å•äº‹åŠ¡)

---

## ğŸ›ï¸ åç«¯æ¶æ„è®¾è®¡

### NestJS æ¨¡å—ç»“æ„

```
apps/api/src/
â”œâ”€â”€ main.ts                    # åº”ç”¨å…¥å£ + Swagger é…ç½®
â”œâ”€â”€ app.module.ts              # æ ¹æ¨¡å—
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ prisma.module.ts       # Prisma æœåŠ¡æ¨¡å—
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ styles/                # æ¬¾å·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ styles.controller.ts
â”‚   â”‚   â”œâ”€â”€ styles.service.ts
â”‚   â”‚   â”œâ”€â”€ styles.module.ts
â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”œâ”€â”€ variants/              # é¢œè‰²ç‰ˆæœ¬æ¨¡å—
â”‚   â”œâ”€â”€ bom-items/             # é…æ–™æ˜ç»†æ¨¡å—
â”‚   â”œâ”€â”€ spec-details/          # è§„æ ¼æ˜ç»†æ¨¡å—
â”‚   â”œâ”€â”€ customers/             # å®¢æˆ·æ¨¡å—
â”‚   â”œâ”€â”€ sizes/                 # å°ºç æ¨¡å—
â”‚   â””â”€â”€ units/                 # å•ä½æ¨¡å—
â””â”€â”€ common/                    # é€šç”¨æ¨¡å—
    â”œâ”€â”€ filters/               # å¼‚å¸¸è¿‡æ»¤å™¨
    â”œâ”€â”€ interceptors/          # æ‹¦æˆªå™¨
    â””â”€â”€ decorators/            # è£…é¥°å™¨
```

### ä¸‰å±‚æ¶æ„æ¨¡å¼

**Controller å±‚** (è·¯ç”±å’Œè¯·æ±‚å¤„ç†)
```typescript
@Controller('styles')
@ApiTags('æ¬¾å·ç®¡ç†')
export class StylesController {
  constructor(private readonly stylesService: StylesService) {}
  
  @Get()
  @ApiOperation({ summary: 'è·å–æ¬¾å·åˆ—è¡¨' })
  async findAll(@Query() query: QueryStyleDto) {
    return this.stylesService.findAll(query);
  }
}
```

**Service å±‚** (ä¸šåŠ¡é€»è¾‘)
```typescript
@Injectable()
export class StylesService {
  constructor(private prisma: PrismaService) {}
  
  async findAll(query: QueryStyleDto) {
    return this.prisma.style.findMany({
      where: { deletedAt: null },
      include: { colorVariants: true }
    });
  }
}
```

**Module å±‚** (ä¾èµ–æ³¨å…¥)
```typescript
@Module({
  imports: [PrismaModule],
  controllers: [StylesController],
  providers: [StylesService],
  exports: [StylesService]
})
export class StylesModule {}
```

### API è®¾è®¡è§„èŒƒ

**RESTful é£æ ¼**:
```
GET    /api/styles                    # è·å–æ¬¾å·åˆ—è¡¨
POST   /api/styles                    # åˆ›å»ºæ¬¾å·
GET    /api/styles/:id                # è·å–æ¬¾å·è¯¦æƒ…
PATCH  /api/styles/:id                # æ›´æ–°æ¬¾å·
DELETE /api/styles/:id                # åˆ é™¤æ¬¾å·

GET    /api/styles/:id/variants       # è·å–é¢œè‰²ç‰ˆæœ¬åˆ—è¡¨
POST   /api/styles/:id/variants       # åˆ›å»ºé¢œè‰²ç‰ˆæœ¬
POST   /api/variants/:id/clone        # æ·±åº¦å…‹éš†é¢œè‰²ç‰ˆæœ¬

GET    /api/variants/:id/bom-items    # è·å–é…æ–™åˆ—è¡¨
POST   /api/bom-items                 # åˆ›å»ºé…æ–™
PATCH  /api/bom-items/:id             # æ›´æ–°é…æ–™

GET    /api/bom-items/:id/spec-details # è·å–è§„æ ¼åˆ—è¡¨
POST   /api/spec-details              # æ‰¹é‡åˆ›å»ºè§„æ ¼
```

**Swagger æ–‡æ¡£**:
- è®¿é—®åœ°å€: `http://localhost:3000/docs`
- è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£
- æ”¯æŒåœ¨çº¿æµ‹è¯•

---

## ğŸ¨ å‰ç«¯æ¶æ„è®¾è®¡

### ç»„ä»¶å±‚æ¬¡ç»“æ„

```
App.tsx (Refine é…ç½®)
â”œâ”€â”€ Layout.tsx (ä¸»å¸ƒå±€)
â”‚   â”œâ”€â”€ Header (é¡¶éƒ¨å¯¼èˆª)
â”‚   â””â”€â”€ Sider (ä¾§è¾¹æ èœå•)
â”‚
â””â”€â”€ Pages (é¡µé¢å±‚)
    â”œâ”€â”€ styles/
    â”‚   â”œâ”€â”€ list.tsx (æ¬¾å·åˆ—è¡¨é¡µ)
    â”‚   â””â”€â”€ detail.tsx (æ¬¾å·è¯¦æƒ…é¡µ) â­
    â”‚       â”œâ”€â”€ StyleHeaderInfo (L1 æ¬¾å·ä¿¡æ¯)
    â”‚       â””â”€â”€ VariantTabs (L2 é¢œè‰²åˆ‡æ¢)
    â”‚           â””â”€â”€ VariantTabContent
    â”‚               â”œâ”€â”€ VariantHeader (æ ·è¡£å›¾)
    â”‚               â””â”€â”€ BOMTable (L3 é…æ–™è¡¨æ ¼) â­
    â”‚                   â””â”€â”€ SpecDetailModal (L4 è§„æ ¼ç¼–è¾‘) â­
    â”œâ”€â”€ customers/
    â”‚   â”œâ”€â”€ list.tsx
    â”‚   â””â”€â”€ detail.tsx
    â”œâ”€â”€ sizes/
    â”‚   â””â”€â”€ list.tsx
    â””â”€â”€ units/
        â””â”€â”€ list.tsx
```

### Refine æ•°æ®æä¾›è€…æ¨¡å¼

**å½“å‰å®ç°**: Mock Data Provider (å†…å­˜æ•°æ®)
```typescript
// src/providers/mockDataProvider.ts
export const mockDataProvider: DataProvider = {
  getList: async ({ resource, pagination, filters }) => {
    // ä»å†…å­˜æ•°æ®åº“è¿”å›åˆ—è¡¨
  },
  getOne: async ({ resource, id }) => {
    // è¿”å›å•æ¡è®°å½•
  },
  create: async ({ resource, variables }) => {
    // åˆ›å»ºè®°å½•
  },
  update: async ({ resource, id, variables }) => {
    // æ›´æ–°è®°å½•
  },
  deleteOne: async ({ resource, id }) => {
    // åˆ é™¤è®°å½•
  },
  custom: async ({ url, method, payload }) => {
    // è‡ªå®šä¹‰æ“ä½œ (å¦‚æ·±åº¦å…‹éš†)
  }
};
```

**æœªæ¥å®ç°**: API Data Provider (å·²éƒ¨åˆ†å®ç°)
```typescript
// src/providers/apiDataProvider.ts
export const apiDataProvider = dataProvider(
  "http://localhost:3001/api"
);
```

### æ ¸å¿ƒæŠ€æœ¯å®ç°

#### 1. L4 è§„æ ¼èšåˆæ˜¾ç¤º
```tsx
// BOMTable.tsx
{
  title: 'è§„æ ¼æ˜ç»†',
  dataIndex: 'specDetails',
  render: (_, record) => (
    <div className="space-y-1">
      {record.specDetails.map(spec => (
        <div key={spec.id}>
          <Tag>{spec.size}</Tag>
          {spec.spec_value} {spec.spec_unit}
        </div>
      ))}
      <Button onClick={() => openEditModal(record)}>
        ç¼–è¾‘è§„æ ¼
      </Button>
    </div>
  )
}
```

#### 2. L4 åŠ¨æ€è¡¨å•ç¼–è¾‘
```tsx
// SpecDetailModal.tsx
<Form.List name="specDetails">
  {(fields, { add, remove }) => (
    <>
      {fields.map(field => (
        <Space key={field.key}>
          <Form.Item name={[field.name, 'size']}>
            <Input placeholder="å°ºç " />
          </Form.Item>
          <Form.Item name={[field.name, 'spec_value']}>
            <InputNumber placeholder="è§„æ ¼å€¼" />
          </Form.Item>
          <Form.Item name={[field.name, 'spec_unit']}>
            <Input placeholder="å•ä½" />
          </Form.Item>
          <Button onClick={() => remove(field.name)}>åˆ é™¤</Button>
        </Space>
      ))}
      <Button onClick={() => add()}>æ·»åŠ è§„æ ¼</Button>
    </>
  )}
</Form.List>
```

#### 3. æ·±åº¦å…‹éš† (ä¸‰å±‚çº§è”å¤åˆ¶)
```typescript
// å‰ç«¯è°ƒç”¨
const handleClone = async (newColorName: string) => {
  await custom({
    url: `/styles/${styleId}/variants/${variantId}/clone`,
    method: 'post',
    payload: { new_color_name: newColorName }
  });
  refetch(); // åˆ·æ–°æ•°æ®
};

// åç«¯å®ç° (ä¼ªä»£ç )
async cloneVariant(sourceId, newColorName) {
  return this.prisma.$transaction(async (tx) => {
    // 1. å¤åˆ¶ L2 é¢œè‰²ç‰ˆæœ¬
    const newVariant = await tx.colorVariant.create({
      data: { ...sourceVariant, colorName: newColorName }
    });
    
    // 2. æŸ¥è¯¢å¹¶å¤åˆ¶æ‰€æœ‰ L3 é…æ–™
    const sourceBomItems = await tx.bomItem.findMany({
      where: { variantId: sourceId },
      include: { specDetails: true }
    });
    
    for (const bomItem of sourceBomItems) {
      // 3. å¤åˆ¶ L3 é…æ–™
      const newBomItem = await tx.bomItem.create({
        data: {
          ...bomItem,
          variantId: newVariant.id,
          specDetails: {
            // 4. çº§è”å¤åˆ¶ L4 è§„æ ¼
            create: bomItem.specDetails.map(spec => ({
              size: spec.size,
              specValue: spec.specValue,
              specUnit: spec.specUnit
            }))
          }
        }
      });
    }
    
    return newVariant;
  });
}
```

---

## ğŸ” æ•°æ®æŒä¹…åŒ–ç­–ç•¥

### å‰ç«¯æŒä¹…åŒ– (Dexie + IndexedDB)

**ç”¨é€”**:
- ç¦»çº¿æ•°æ®ç¼“å­˜
- å‡å°‘ API è¯·æ±‚
- æå‡ç”¨æˆ·ä½“éªŒ

**å®ç°**:
```typescript
// å®šä¹‰ IndexedDB Schema
const db = new Dexie('SpecMasterDB');
db.version(1).stores({
  styles: '++id, style_no',
  colorVariants: '++id, style_id',
  bomItems: '++id, variant_id',
  specDetails: '++id, bom_item_id'
});
```

### åç«¯æŒä¹…åŒ– (PostgreSQL)

**ç‰¹ç‚¹**:
- ACID äº‹åŠ¡ä¿è¯
- å¤–é”®çº§è”åˆ é™¤
- è½¯åˆ é™¤æ”¯æŒ (deletedAt)
- å®¡è®¡å­—æ®µ (createdAt, updatedAt)

---

## ğŸ“¦ æ–‡ä»¶å­˜å‚¨æ–¹æ¡ˆ

### å‰ç«¯ä¸Šä¼ æµç¨‹
```
ç”¨æˆ·é€‰æ‹©æ–‡ä»¶
  â†“
å‰ç«¯è°ƒç”¨ä¸ƒç‰›äº‘ Token API
  â†“
è·å–ä¸Šä¼ å‡­è¯
  â†“
ç›´ä¼ ä¸ƒç‰›äº‘ OSS
  â†“
è¿”å›æ–‡ä»¶ URL
  â†“
ä¿å­˜ URL åˆ°æ•°æ®åº“
```

### åç«¯ S3 é›†æˆ
```typescript
import { S3Client, PutObjectCommand } from '@aws-sdk/client-s3';

const s3Client = new S3Client({
  region: process.env.AWS_REGION,
  credentials: {
    accessKeyId: process.env.AWS_ACCESS_KEY_ID,
    secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY
  }
});

async uploadFile(file: Buffer, key: string) {
  await s3Client.send(new PutObjectCommand({
    Bucket: process.env.AWS_BUCKET,
    Key: key,
    Body: file
  }));
}
```

---

## ğŸš€ å¼€å‘å·¥ä½œæµ

### æœ¬åœ°å¼€å‘

**1. å¯åŠ¨æ•°æ®åº“**
```bash
docker-compose up -d
```

**2. åˆå§‹åŒ–æ•°æ®åº“**
```bash
cd apps/api
npx prisma migrate dev
npx prisma db seed  # å¦‚æœæœ‰ç§å­æ•°æ®
```

**3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨**
```bash
# æ ¹ç›®å½• (åŒæ—¶å¯åŠ¨å‰åç«¯)
pnpm dev

# æˆ–åˆ†åˆ«å¯åŠ¨
cd apps/api && pnpm start:dev    # åç«¯ (port 3001)
cd apps/web && pnpm dev          # å‰ç«¯ (port 3000)
```

**4. è®¿é—®åº”ç”¨**
- å‰ç«¯: http://localhost:3000
- åç«¯ API: http://localhost:3001
- Swagger æ–‡æ¡£: http://localhost:3001/docs
- Prisma Studio: `npx prisma studio`

### æ•°æ®åº“è¿ç§»

**åˆ›å»ºè¿ç§»**
```bash
cd apps/api
npx prisma migrate dev --name add_user_table
```

**åº”ç”¨è¿ç§» (ç”Ÿäº§)**
```bash
npx prisma migrate deploy
```

**é‡ç½®æ•°æ®åº“**
```bash
npx prisma migrate reset  # è­¦å‘Š: åˆ é™¤æ‰€æœ‰æ•°æ®
```

### æ„å»ºéƒ¨ç½²

**æ„å»ºæ‰€æœ‰åº”ç”¨**
```bash
# ä½¿ç”¨ Turborepo å¹¶è¡Œæ„å»º
turbo run build
```

**å•ç‹¬æ„å»º**
```bash
cd apps/api && pnpm build  # è¾“å‡ºåˆ° dist/
cd apps/web && pnpm build  # è¾“å‡ºåˆ° dist/
```

---

## ğŸ¯ æŠ€æœ¯äº®ç‚¹

### 1. Monorepo ä¼˜åŠ¿
âœ… **ä»£ç å…±äº«**: ç±»å‹å®šä¹‰ã€å·¥å…·å‡½æ•°å¯è·¨é¡¹ç›®å¤ç”¨  
âœ… **ç»Ÿä¸€ä¾èµ–**: ç‰ˆæœ¬ç®¡ç†é›†ä¸­åŒ–  
âœ… **åŸå­æäº¤**: å‰åç«¯åŒæ­¥ä¿®æ”¹  
âœ… **æ„å»ºä¼˜åŒ–**: Turborepo ç¼“å­˜åŠ é€Ÿ

### 2. ç±»å‹å®‰å…¨
âœ… **ç«¯åˆ°ç«¯ç±»å‹**: Prisma è‡ªåŠ¨ç”Ÿæˆ TypeScript ç±»å‹  
âœ… **API å¥‘çº¦**: Swagger å®šä¹‰ + DTO éªŒè¯  
âœ… **å‰ç«¯ç±»å‹**: ä¸åç«¯å…±äº«æ¥å£å®šä¹‰

### 3. å¼€å‘ä½“éªŒ
âœ… **çƒ­é‡è½½**: Vite (å‰ç«¯) + NestJS Watch (åç«¯)  
âœ… **API æ–‡æ¡£**: Swagger UI è‡ªåŠ¨ç”Ÿæˆ  
âœ… **æ•°æ®åº“ GUI**: Prisma Studio  
âœ… **ä»£ç è´¨é‡**: ESLint + Prettier ç»Ÿä¸€è§„èŒƒ

### 4. æ€§èƒ½ä¼˜åŒ–
âœ… **æ•°æ®åº“ç´¢å¼•**: å¤–é”®ã€ä¸šåŠ¡æŸ¥è¯¢ã€å…¨æ–‡æœç´¢  
âœ… **è¿æ¥æ± **: Prisma + pg é©±åŠ¨  
âœ… **å‰ç«¯ç¼“å­˜**: IndexedDB ç¦»çº¿å­˜å‚¨  
âœ… **æ„å»ºç¼“å­˜**: Turborepo å¢é‡æ„å»º

### 5. ä¼ä¸šçº§ç‰¹æ€§
âœ… **è½¯åˆ é™¤**: ä¿ç•™å†å²æ•°æ®  
âœ… **å®¡è®¡æ—¥å¿—**: åˆ›å»ºäººã€ä¿®æ”¹äººã€æ—¶é—´æˆ³  
âœ… **äº‹åŠ¡æ”¯æŒ**: Prisma $transaction  
âœ… **æƒé™æ§åˆ¶**: Refine å†…ç½®æ”¯æŒ (å¾…å®ç°)

---

## ğŸ“Š é¡¹ç›®è§„æ¨¡

### ä»£ç ç»Ÿè®¡
- **åç«¯æ¨¡å—**: 7 ä¸ªä¸šåŠ¡æ¨¡å—
- **å‰ç«¯é¡µé¢**: 6 ä¸ªä¸»è¦é¡µé¢
- **æ•°æ®åº“è¡¨**: 7 å¼ è¡¨ (4 æ ¸å¿ƒ + 3 è¾…åŠ©)
- **API ç«¯ç‚¹**: çº¦ 30+ ä¸ª RESTful æ¥å£

### ä¾èµ–ç»Ÿè®¡
- **åç«¯ä¾èµ–**: 36 ä¸ªç”Ÿäº§ä¾èµ– + 62 ä¸ªå¼€å‘ä¾èµ–
- **å‰ç«¯ä¾èµ–**: 29 ä¸ªç”Ÿäº§ä¾èµ– + 48 ä¸ªå¼€å‘ä¾èµ–
- **å…±äº«ä¾èµ–**: 1 ä¸ª (Turborepo)

---

## ğŸ”® æŠ€æœ¯æ¼”è¿›æ–¹å‘

### çŸ­æœŸä¼˜åŒ–
- [ ] å®Œå–„ API ç«¯ç‚¹å®ç°
- [ ] å‰ç«¯åˆ‡æ¢åˆ°çœŸå® API Data Provider
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•å’Œ E2E æµ‹è¯•
- [ ] å®ç°ç”¨æˆ·è®¤è¯å’Œæƒé™æ§åˆ¶

### ä¸­æœŸè§„åˆ’
- [ ] æå–å…±äº«åŒ… (packages/shared)
- [ ] æ·»åŠ  GraphQL æ”¯æŒ (å¯é€‰)
- [ ] å®ç°å®æ—¶åä½œ (WebSocket)
- [ ] æ€§èƒ½ç›‘æ§å’Œæ—¥å¿—ç³»ç»Ÿ

### é•¿æœŸæ„¿æ™¯
- [ ] å¾®æœåŠ¡æ‹†åˆ† (å¦‚éœ€è¦)
- [ ] å¤šç§Ÿæˆ·æ”¯æŒ
- [ ] å›½é™…åŒ– (i18n)
- [ ] ç§»åŠ¨ç«¯é€‚é… (React Native)

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ•°æ®åº“è®¾è®¡æ–‡æ¡£](./docs/æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md)
- [å‰ç«¯ README](./apps/web/README.md)
- [åç«¯ README](./apps/api/README.md)
- [CLAUDE.md](./CLAUDE.md) - AI å¼€å‘æŒ‡å—

---

## ğŸ† æ€»ç»“

SpecMaster æ˜¯ä¸€ä¸ª**ç°ä»£åŒ–ã€ä¼ä¸šçº§çš„ Monorepo å…¨æ ˆé¡¹ç›®**ï¼Œé‡‡ç”¨äº†ä¸šç•Œæœ€ä½³å®è·µï¼š

**æ¶æ„å±‚é¢**:
- âœ… Monorepo + Turborepo é«˜æ•ˆç®¡ç†
- âœ… å‰åç«¯åˆ†ç¦» + RESTful API
- âœ… å››çº§åµŒå¥—æ•°æ®æ¨¡å‹è®¾è®¡

**æŠ€æœ¯é€‰å‹**:
- âœ… NestJS + Prisma (åç«¯é»„é‡‘ç»„åˆ)
- âœ… React + Refine (ä¼ä¸šçº§å‰ç«¯)
- âœ… PostgreSQL (å¯é çš„å…³ç³»å‹æ•°æ®åº“)

**å·¥ç¨‹åŒ–**:
- âœ… TypeScript å…¨æ ˆç±»å‹å®‰å…¨
- âœ… Docker Compose ä¸€é”®ç¯å¢ƒ
- âœ… ESLint + Prettier ä»£ç è§„èŒƒ
- âœ… Swagger è‡ªåŠ¨åŒ–æ–‡æ¡£

**ä¸šåŠ¡ä»·å€¼**:
- âœ… è§£å†³æœè£…è¡Œä¸šç—›ç‚¹
- âœ… ç›´è§‚çš„å››çº§æ•°æ®å±•ç¤º
- âœ… é«˜æ•ˆçš„æ·±åº¦å…‹éš†åŠŸèƒ½
- âœ… ç¦»çº¿ä¼˜å…ˆçš„ç”¨æˆ·ä½“éªŒ

---

**ç”Ÿæˆæ—¶é—´**: 2026-01-14  
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**é¡¹ç›®ç‰ˆæœ¬**: 1.0.0
