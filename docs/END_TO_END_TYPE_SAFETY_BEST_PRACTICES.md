# ç«¯åˆ°ç«¯ç±»å‹å®‰å…¨æœ€ä½³å®è·µ

> åŸºäº SpecMaster é¡¹ç›®å®è·µæ€»ç»“çš„å®Œæ•´æŒ‡å—

## ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
- [å®æ–½æ­¥éª¤](#å®æ–½æ­¥éª¤)
- [æŠ€æœ¯æ ˆé€‰å‹](#æŠ€æœ¯æ ˆé€‰å‹)
- [ä»£ç è§„èŒƒ](#ä»£ç è§„èŒƒ)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [è¿ç§»æ£€æŸ¥æ¸…å•](#è¿ç§»æ£€æŸ¥æ¸…å•)

---

## æ¦‚è¿°

### ä»€ä¹ˆæ˜¯ç«¯åˆ°ç«¯ç±»å‹å®‰å…¨ï¼Ÿ

ç«¯åˆ°ç«¯ç±»å‹å®‰å…¨æ˜¯æŒ‡ä»åç«¯ API åˆ°å‰ç«¯ UI çš„å®Œæ•´ç±»å‹é“¾è·¯ï¼Œç¡®ä¿ï¼š

1. **å•ä¸€æ•°æ®æº**ï¼šOpenAPI è§„èŒƒä½œä¸ºå”¯ä¸€çš„ API å¥‘çº¦
2. **è‡ªåŠ¨ç±»å‹ç”Ÿæˆ**ï¼šåç«¯å˜æ›´è‡ªåŠ¨åæ˜ åˆ°å‰ç«¯ç±»å‹
3. **ç¼–è¯‘æ—¶æ£€æŸ¥**ï¼šç±»å‹é”™è¯¯åœ¨ç¼–è¯‘é˜¶æ®µè¢«å‘ç°ï¼Œè€Œéè¿è¡Œæ—¶
4. **é‡æ„å®‰å…¨**ï¼šå­—æ®µé‡å‘½åã€ç±»å‹å˜æ›´ç­‰æ“ä½œæœ‰ç¼–è¯‘å™¨ä¿æŠ¤

### æ ¸å¿ƒä»·å€¼

- âœ… **å‡å°‘ Bug**ï¼šæ¶ˆé™¤å‰åç«¯å­—æ®µåä¸åŒ¹é…ã€ç±»å‹é”™è¯¯ç­‰é—®é¢˜
- âœ… **æå‡æ•ˆç‡**ï¼šè‡ªåŠ¨ç”Ÿæˆç±»å‹ï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤
- âœ… **å®‰å…¨é‡æ„**ï¼šé‡å‘½åå­—æ®µæ—¶ï¼Œæ‰€æœ‰å¼•ç”¨å¤„éƒ½ä¼šæŠ¥é”™æç¤º
- âœ… **æ–‡æ¡£åŒæ­¥**ï¼šAPI æ–‡æ¡£ä¸å®é™…ä»£ç å§‹ç»ˆä¸€è‡´
- âœ… **å›¢é˜Ÿåä½œ**ï¼šå‰åç«¯åŸºäºåŒä¸€ä»½ç±»å‹å®šä¹‰å·¥ä½œ

### é€‚ç”¨åœºæ™¯

- âœ… NestJS + React/Vue/Angular å…¨æ ˆé¡¹ç›®
- âœ… å¾®æœåŠ¡æ¶æ„ä¸­çš„æœåŠ¡é—´é€šä¿¡
- âœ… éœ€è¦é¢‘ç¹è¿­ä»£çš„ä¸šåŠ¡ç³»ç»Ÿ
- âœ… å¤šäººåä½œçš„ä¸­å¤§å‹é¡¹ç›®
- âŒ ç®€å•çš„é™æ€ç½‘ç«™æˆ–çº¯å±•ç¤ºé¡µé¢

---

## æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Backend (NestJS)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   DTOs       â”‚  â”‚  Services    â”‚  â”‚ Controllers  â”‚      â”‚
â”‚  â”‚ (camelCase)  â”‚â†’ â”‚              â”‚â†’ â”‚ + Swagger    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â†“
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  OpenAPI Spec   â”‚
                                    â”‚  (openapi.json) â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â†“
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚openapi-typescriptâ”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Frontend (React)     â”‚                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Components  â”‚â† â”‚ DataProvider â”‚â† â”‚ Generated  â”‚        â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚   Types    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Monorepo ç»“æ„

```
project-root/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ api/                    # NestJS åç«¯
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ users/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ dto/
â”‚   â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ create-user.dto.ts
â”‚   â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ update-user.dto.ts
â”‚   â”‚   â”‚   â”‚       â”‚   â””â”€â”€ user-response.dto.ts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ users.controller.ts
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ users.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ main.ts
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â””â”€â”€ web/                    # React å‰ç«¯
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ providers/
â”‚       â”‚   â”‚   â””â”€â”€ apiDataProvider.ts
â”‚       â”‚   â”œâ”€â”€ types/
â”‚       â”‚   â”‚   â””â”€â”€ legacy.ts
â”‚       â”‚   â””â”€â”€ components/
â”‚       â””â”€â”€ package.json
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ api-contract/           # OpenAPI è§„èŒƒåŒ…
â”‚   â”‚   â”œâ”€â”€ openapi.json
â”‚   â”‚   â”œâ”€â”€ generate.sh
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â””â”€â”€ types/                  # ç±»å‹å®šä¹‰åŒ…
â”‚       â”œâ”€â”€ src/generated/
â”‚       â”‚   â””â”€â”€ models.ts
â”‚       â”œâ”€â”€ generate.sh
â”‚       â””â”€â”€ package.json
â”œâ”€â”€ pnpm-workspace.yaml
â””â”€â”€ turbo.json
```

### æ•°æ®æµå‘

1. **å¼€å‘é˜¶æ®µ**ï¼šå¼€å‘è€…åœ¨åç«¯å®šä¹‰ DTOï¼ˆä½¿ç”¨ Swagger è£…é¥°å™¨ï¼‰
2. **æ„å»ºé˜¶æ®µ**ï¼šåç«¯å¯åŠ¨åæš´éœ² OpenAPI JSON è§„èŒƒ
3. **ç”Ÿæˆé˜¶æ®µ**ï¼š`api-contract` åŒ…ä¸‹è½½ OpenAPI è§„èŒƒ
4. **è½¬æ¢é˜¶æ®µ**ï¼š`types` åŒ…ä½¿ç”¨ `openapi-typescript` ç”Ÿæˆ TypeScript ç±»å‹
5. **ä½¿ç”¨é˜¶æ®µ**ï¼šå‰ç«¯å¯¼å…¥ç”Ÿæˆçš„ç±»å‹ï¼Œè·å¾—å®Œæ•´çš„ç±»å‹æç¤º

---

## å®æ–½æ­¥éª¤

### Phase 1: åŸºç¡€è®¾æ–½æ­å»ºï¼ˆç¬¬ 1-2 å‘¨ï¼‰

#### 1.1 åˆ›å»º api-contract åŒ…

```bash
mkdir -p packages/api-contract
cd packages/api-contract
pnpm init
```

**packages/api-contract/package.json**:

```json
{
  "name": "@your-project/api-contract",
  "version": "1.0.0",
  "description": "OpenAPI specification",
  "main": "openapi.json",
  "scripts": {
    "generate": "./generate.sh"
  }
}
```

**packages/api-contract/generate.sh**:

```bash
#!/bin/bash
set -e

echo "ğŸ”„ Generating OpenAPI specification..."
API_URL="http://localhost:3000"

# ç­‰å¾…æœåŠ¡å¯åŠ¨
timeout 30 bash -c 'until curl -s $API_URL > /dev/null; do sleep 1; done'

# ä¸‹è½½ OpenAPI è§„èŒƒ
curl -s "${API_URL}/docs-json" -o openapi.json

echo "âœ… OpenAPI specification generated"
```

```bash
chmod +x generate.sh
```

#### 1.2 åˆ›å»º types åŒ…

```bash
mkdir -p packages/types/src/generated
cd packages/types
pnpm init
pnpm add -D openapi-typescript typescript
```

**packages/types/package.json**:

```json
{
  "name": "@your-project/types",
  "version": "1.0.0",
  "main": "src/generated/models.ts",
  "types": "src/generated/models.d.ts",
  "scripts": {
    "generate": "./generate.sh"
  },
  "devDependencies": {
    "openapi-typescript": "^7.4.4",
    "typescript": "^5.7.3"
  }
}
```

**packages/types/generate.sh**:

```bash
#!/bin/bash
set -e

echo "ğŸ”„ Generating TypeScript types..."

if [ ! -f "../api-contract/openapi.json" ]; then
  echo "âŒ OpenAPI spec not found"
  exit 1
fi

npx openapi-typescript ../api-contract/openapi.json \
  --output src/generated/models.ts \
  --export-type

echo "âœ… TypeScript types generated"
```

```bash
chmod +x generate.sh
```

---

### Phase 2: åç«¯è¿ç§»ï¼ˆç¬¬ 3-4 å‘¨ï¼‰

#### 2.1 å®šä¹‰ Response DTO

**å…³é”®åŸåˆ™**ï¼šä¸ºæ¯ä¸ªæ¨¡å—åˆ›å»ºä¸“é—¨çš„ Response DTOï¼Œä¸ Create/Update DTO åˆ†ç¦»ã€‚

**apps/api/src/modules/users/dto/user-response.dto.ts**:

```typescript
import { ApiProperty, ApiPropertyOptional } from '@nestjs/swagger';

export class UserResponseDto {
  @ApiProperty({ description: 'ç”¨æˆ·ID', example: 1 })
  id: number;

  @ApiProperty({ description: 'ç”¨æˆ·å', example: 'john_doe' })
  username: string;

  @ApiProperty({ description: 'é‚®ç®±', example: 'john@example.com' })
  email: string;

  @ApiPropertyOptional({ description: 'æ˜µç§°', example: 'John' })
  nickname?: string;

  @ApiProperty({ description: 'åˆ›å»ºæ—¶é—´' })
  createdAt: string;

  @ApiProperty({ description: 'æ›´æ–°æ—¶é—´' })
  updatedAt: string;
}

export class UserListResponseDto {
  @ApiProperty({ type: [UserResponseDto], description: 'ç”¨æˆ·åˆ—è¡¨' })
  data: UserResponseDto[];

  @ApiProperty({ description: 'æ€»è®°å½•æ•°', example: 100 })
  total: number;
}
```

#### 2.2 æ›´æ–° Controller

åœ¨ Controller ä¸­ä½¿ç”¨ `@ApiResponse` è£…é¥°å™¨æŒ‡å®šè¿”å›ç±»å‹ï¼š

```typescript
import { Controller, Get, Post, Put, Delete, Param, Body } from '@nestjs/common';
import { ApiTags, ApiResponse, ApiOperation } from '@nestjs/swagger';
import { UserResponseDto, UserListResponseDto } from './dto';

@ApiTags('users')
@Controller('api/users')
export class UsersController {
  constructor(private readonly usersService: UsersService) {}

  @Get()
  @ApiOperation({ summary: 'è·å–ç”¨æˆ·åˆ—è¡¨' })
  @ApiResponse({ status: 200, type: UserListResponseDto })
  async findAll() {
    return this.usersService.findAll();
  }

  @Get(':id')
  @ApiOperation({ summary: 'è·å–ç”¨æˆ·è¯¦æƒ…' })
  @ApiResponse({ status: 200, type: UserResponseDto })
  async findOne(@Param('id') id: string) {
    return this.usersService.findOne(+id);
  }

  @Post()
  @ApiOperation({ summary: 'åˆ›å»ºç”¨æˆ·' })
  @ApiResponse({ status: 201, type: UserResponseDto })
  async create(@Body() dto: CreateUserDto) {
    return this.usersService.create(dto);
  }
}
```

#### 2.3 æ›´æ–° Service

Service å±‚ç›´æ¥è¿”å›æ•°æ®ï¼Œæ— éœ€æ‰‹åŠ¨è½¬æ¢ï¼š

```typescript
@Injectable()
export class UsersService {
  constructor(private prisma: PrismaService) {}

  async findAll() {
    const [data, total] = await Promise.all([
      this.prisma.user.findMany(),
      this.prisma.user.count(),
    ]);
    return { data, total };
  }

  async findOne(id: number) {
    const user = await this.prisma.user.findUnique({ where: { id } });
    return { data: user };
  }

  async create(dto: CreateUserDto) {
    const user = await this.prisma.user.create({
      data: {
        username: dto.username,
        email: dto.email,
        nickname: dto.nickname,
      },
    });
    return { data: user };
  }
}
```

---

### Phase 3: å‰ç«¯è¿ç§»ï¼ˆç¬¬ 5-6 å‘¨ï¼‰

#### 3.1 ç”Ÿæˆç±»å‹

```bash
# 1. å¯åŠ¨åç«¯æœåŠ¡
cd apps/api && pnpm start:dev

# 2. ç”Ÿæˆ OpenAPI è§„èŒƒ
cd packages/api-contract && pnpm generate

# 3. ç”Ÿæˆ TypeScript ç±»å‹
cd packages/types && pnpm generate
```

#### 3.2 åˆ›å»ºç±»å‹æ¡¥æ¥æ–‡ä»¶

**apps/web/src/types/legacy.ts**:

```typescript
import type { components } from "@your-project/types";

// å¯¼å‡ºç”Ÿæˆçš„ç±»å‹
export type IUser = components["schemas"]["UserResponseDto"];
export type IUserList = components["schemas"]["UserListResponseDto"];
export type ICreateUser = components["schemas"]["CreateUserDto"];
export type IUpdateUser = components["schemas"]["UpdateUserDto"];

// è‡ªå®šä¹‰æ‰©å±•ç±»å‹ï¼ˆå¦‚æœéœ€è¦ï¼‰
export interface IUserWithRoles extends IUser {
  roles?: string[];
}
```

#### 3.3 æ›´æ–° DataProvider

```typescript
import type { components } from "@your-project/types";

type UserResponseDto = components["schemas"]["UserResponseDto"];

export const apiDataProvider = {
  getList: async ({ resource, pagination, filters }) => {
    const url = `${API_BASE_URL}/${resource}`;
    const result = await request<{ data: any[]; total: number }>(url);
    return { data: result.data, total: result.total };
  },

  getOne: async ({ resource, id }) => {
    const url = `${API_BASE_URL}/${resource}/${id}`;
    const result = await request<{ data: UserResponseDto }>(url);
    return { data: result.data };
  },

  create: async ({ resource, variables }) => {
    const url = `${API_BASE_URL}/${resource}`;
    const result = await request<{ data: UserResponseDto }>(url, {
      method: "POST",
      body: JSON.stringify(variables),
    });
    return { data: result.data };
  },
};
```

---

## æŠ€æœ¯æ ˆé€‰å‹

### å¿…éœ€ä¾èµ–

| å·¥å…· | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| `@nestjs/swagger` | ^7.x | ç”Ÿæˆ OpenAPI è§„èŒƒ |
| `openapi-typescript` | ^7.x | ç”Ÿæˆ TypeScript ç±»å‹ |
| `typescript` | ^5.x | ç±»å‹æ£€æŸ¥ |

### å¯é€‰ä¾èµ–

| å·¥å…· | ç”¨é€” |
|------|------|
| `class-validator` | DTO éªŒè¯ |
| `class-transformer` | æ•°æ®è½¬æ¢ |
| `@refinedev/core` | å‰ç«¯æ•°æ®å±‚æŠ½è±¡ |

---

## ä»£ç è§„èŒƒ

### å‘½åè§„èŒƒ

#### 1. ç»Ÿä¸€ä½¿ç”¨ camelCase

**âœ… æ­£ç¡®**:

```typescript
export class UserResponseDto {
  userId: number;
  userName: string;
  createdAt: string;
}
```

**âŒ é”™è¯¯**:

```typescript
export class UserResponseDto {
  user_id: number;        // snake_case
  UserName: string;       // PascalCase
  created_at: string;     // snake_case
}
```

#### 2. DTO å‘½åçº¦å®š

- **Request DTO**: `Create{Entity}Dto`, `Update{Entity}Dto`
- **Response DTO**: `{Entity}ResponseDto`, `{Entity}ListResponseDto`

```typescript
// Request DTOs
export class CreateUserDto { }
export class UpdateUserDto { }

// Response DTOs
export class UserResponseDto { }
export class UserListResponseDto { }
```

#### 3. åµŒå¥—å…³ç³»å‘½å

```typescript
export class OrderResponseDto {
  @ApiProperty({ type: [OrderItemResponseDto] })
  orderItems: OrderItemResponseDto[];  // ä½¿ç”¨å¤æ•°å½¢å¼
}
```

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆéœ€è¦å•ç‹¬çš„ Response DTOï¼Ÿ

**A**: åˆ†ç¦»å…³æ³¨ç‚¹ï¼Œæé«˜å¯ç»´æŠ¤æ€§ï¼š

- **Request DTO**: ç”¨äºéªŒè¯å’Œè½¬æ¢ç”¨æˆ·è¾“å…¥
- **Response DTO**: å®šä¹‰ API è¿”å›çš„æ•°æ®ç»“æ„
- **å¥½å¤„**: 
  - è¾“å…¥å’Œè¾“å‡ºå¯ä»¥æœ‰ä¸åŒçš„å­—æ®µï¼ˆå¦‚å¯†ç å­—æ®µåªåœ¨è¾“å…¥æ—¶éœ€è¦ï¼‰
  - å“åº”å¯ä»¥åŒ…å«è®¡ç®—å­—æ®µæˆ–å…³è”æ•°æ®
  - æ›´æ¸…æ™°çš„ API æ–‡æ¡£

### Q2: Prisma è¿”å›çš„æ•°æ®å·²ç»æ˜¯ camelCaseï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ Response DTOï¼Ÿ

**A**: Response DTO çš„ä½œç”¨ä¸ä»…æ˜¯å‘½åè½¬æ¢ï¼š

1. **ç±»å‹å®‰å…¨**: æ˜ç¡®å®šä¹‰ API å¥‘çº¦
2. **æ–‡æ¡£ç”Ÿæˆ**: Swagger è£…é¥°å™¨ç”Ÿæˆå‡†ç¡®çš„ API æ–‡æ¡£
3. **å­—æ®µæ§åˆ¶**: å¯ä»¥éšè—æ•æ„Ÿå­—æ®µï¼ˆå¦‚å¯†ç å“ˆå¸Œï¼‰
4. **æ‰©å±•æ€§**: å¯ä»¥æ·»åŠ è®¡ç®—å­—æ®µæˆ–å…³è”æ•°æ®

### Q3: å¦‚ä½•å¤„ç†åµŒå¥—å…³ç³»ï¼Ÿ

**A**: åœ¨ Response DTO ä¸­æ˜ç¡®å®šä¹‰åµŒå¥—ç±»å‹ï¼š

```typescript
import { SpecDetailResponseDto } from '../spec-details/dto';

export class BOMItemResponseDto {
  @ApiProperty({ description: 'BOM ID' })
  id: number;

  @ApiPropertyOptional({ 
    description: 'è§„æ ¼æ˜ç»†åˆ—è¡¨', 
    type: [SpecDetailResponseDto] 
  })
  specDetails?: SpecDetailResponseDto[];
}
```

### Q4: ç±»å‹ç”Ÿæˆå¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**: æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š

1. **æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ**: `curl http://localhost:3000/docs-json`
2. **æ£€æŸ¥ OpenAPI è§„èŒƒæ˜¯å¦ç”Ÿæˆ**: `cat packages/api-contract/openapi.json`
3. **æ£€æŸ¥ Swagger è£…é¥°å™¨**: ç¡®ä¿æ‰€æœ‰ DTO éƒ½æœ‰ `@ApiProperty` è£…é¥°å™¨
4. **æŸ¥çœ‹ç”Ÿæˆæ—¥å¿—**: è¿è¡Œ `pnpm generate` æŸ¥çœ‹é”™è¯¯ä¿¡æ¯

---

### Q5: å¦‚ä½•å¤„ç†å‰ç«¯ç»„ä»¶çš„ç±»å‹è¿ç§»ï¼Ÿ

**A**: ä½¿ç”¨ç±»å‹æ¡¥æ¥æ–‡ä»¶é€æ­¥è¿ç§»ï¼š

```typescript
// 1. åœ¨ legacy.ts ä¸­å¯¼å‡ºæ–°ç±»å‹
export type IUser = components["schemas"]["UserResponseDto"];

// 2. åœ¨ç»„ä»¶ä¸­é€æ­¥æ›¿æ¢
// æ—§ä»£ç 
const user: any = data;
console.log(user.user_name);

// æ–°ä»£ç 
const user: IUser = data;
console.log(user.userName);  // ç±»å‹å®‰å…¨ï¼Œæœ‰è‡ªåŠ¨è¡¥å…¨
```

### Q6: å¦‚ä½•é¿å…é‡å¤çš„ DTO å®šä¹‰ï¼Ÿ

**A**: ä½¿ç”¨ `@ApiExtraModels` è£…é¥°å™¨æˆ–é‡å‘½åï¼š

```typescript
// æ–¹æ¡ˆ 1: é‡å‘½åé¿å…å†²çª
export class CreateBOMSpecDetailDto { }
export class CreateSpecDetailDto { }

// æ–¹æ¡ˆ 2: ä½¿ç”¨ @ApiExtraModels
@ApiExtraModels(CreateSpecDetailDto)
export class BOMItemsController { }
```

---

## è¿ç§»æ£€æŸ¥æ¸…å•

### åç«¯è¿ç§»æ£€æŸ¥æ¸…å•

- [ ] **åŸºç¡€è®¾æ–½**
  - [ ] åˆ›å»º `packages/api-contract` åŒ…
  - [ ] åˆ›å»º `packages/types` åŒ…
  - [ ] é…ç½® Swagger åœ¨ `main.ts`
  - [ ] é…ç½® pnpm workspace

- [ ] **DTO è¿ç§»**
  - [ ] ä¸ºæ¯ä¸ªæ¨¡å—åˆ›å»º Response DTO
  - [ ] æ‰€æœ‰å­—æ®µä½¿ç”¨ camelCase å‘½å
  - [ ] æ·»åŠ  `@ApiProperty` è£…é¥°å™¨
  - [ ] å®šä¹‰åµŒå¥—å…³ç³»ç±»å‹

- [ ] **Service è¿ç§»**
  - [ ] ç§»é™¤æ‰‹åŠ¨è½¬æ¢é€»è¾‘ï¼ˆå¦‚ `transformToSnakeCase`ï¼‰
  - [ ] æ›´æ–°æ‰€æœ‰ DTO å­—æ®µè®¿é—®ä¸º camelCase
  - [ ] ç¡®ä¿è¿”å›æ ¼å¼ä¸º `{ data: ... }`

- [ ] **Controller è¿ç§»**
  - [ ] æ·»åŠ  `@ApiResponse` è£…é¥°å™¨
  - [ ] æŒ‡å®šæ­£ç¡®çš„ Response DTO ç±»å‹
  - [ ] æ·»åŠ  `@ApiOperation` æè¿°

- [ ] **éªŒè¯**
  - [ ] è¿è¡Œ `pnpm build` ç¡®ä¿ 0 é”™è¯¯
  - [ ] è®¿é—® `/docs` æŸ¥çœ‹ Swagger æ–‡æ¡£
  - [ ] ä¸‹è½½ `/docs-json` æ£€æŸ¥ OpenAPI è§„èŒƒ

---

### å‰ç«¯è¿ç§»æ£€æŸ¥æ¸…å•

- [ ] **ç±»å‹ç”Ÿæˆ**
  - [ ] åœ¨ `apps/web/package.json` æ·»åŠ  `@your-project/types` ä¾èµ–
  - [ ] è¿è¡Œ `pnpm install` å®‰è£…ä¾èµ–
  - [ ] ç”Ÿæˆ OpenAPI è§„èŒƒå’Œ TypeScript ç±»å‹

- [ ] **ç±»å‹æ¡¥æ¥**
  - [ ] åˆ›å»º `apps/web/src/types/legacy.ts`
  - [ ] å¯¼å‡ºæ‰€æœ‰éœ€è¦çš„ç±»å‹åˆ«å
  - [ ] å®šä¹‰è‡ªå®šä¹‰æ‰©å±•ç±»å‹

- [ ] **DataProvider è¿ç§»**
  - [ ] å¯¼å…¥ç”Ÿæˆçš„ç±»å‹
  - [ ] æ›´æ–°æ‰€æœ‰ API è°ƒç”¨çš„ç±»å‹æ³¨è§£
  - [ ] æµ‹è¯•æ‰€æœ‰ CRUD æ“ä½œ

- [ ] **ç»„ä»¶è¿ç§»**
  - [ ] æ›´æ–°æ‰€æœ‰å­—æ®µè®¿é—®ä¸º camelCase
  - [ ] æ›¿æ¢ `any` ç±»å‹ä¸ºå…·ä½“ç±»å‹
  - [ ] æ›´æ–°è¡¨æ ¼åˆ—å®šä¹‰çš„ `dataIndex`
  - [ ] æ›´æ–°è¡¨å•å­—æ®µåç§°

- [ ] **éªŒè¯**
  - [ ] è¿è¡Œ `pnpm build` ç¡®ä¿ 0 é”™è¯¯
  - [ ] æµ‹è¯•æ‰€æœ‰é¡µé¢çš„æ•°æ®åŠ è½½
  - [ ] æµ‹è¯•æ‰€æœ‰è¡¨å•æäº¤
  - [ ] æµ‹è¯•åµŒå¥—æ•°æ®åŠ è½½

---

## æœ€ä½³å®è·µæ€»ç»“

### 1. å¼€å‘æµç¨‹

```bash
# 1. ä¿®æ”¹åç«¯ DTO
vim apps/api/src/modules/users/dto/user-response.dto.ts

# 2. é‡å¯åç«¯æœåŠ¡ï¼ˆwatch æ¨¡å¼ä¼šè‡ªåŠ¨é‡å¯ï¼‰
# åç«¯ä¼šè‡ªåŠ¨æ›´æ–° Swagger æ–‡æ¡£

# 3. é‡æ–°ç”Ÿæˆç±»å‹
cd packages/api-contract && pnpm generate
cd packages/types && pnpm generate

# 4. å‰ç«¯è‡ªåŠ¨è·å¾—æ–°ç±»å‹
# TypeScript ç¼–è¯‘å™¨ä¼šæç¤ºæ‰€æœ‰éœ€è¦ä¿®æ”¹çš„åœ°æ–¹
```

### 2. å›¢é˜Ÿåä½œ

- **åç«¯å¼€å‘è€…**: 
  - ä¿®æ”¹ DTO åç«‹å³ç”Ÿæˆæ–°çš„ OpenAPI è§„èŒƒ
  - æäº¤ä»£ç æ—¶åŒ…å« `packages/api-contract/openapi.json`
  - åœ¨ PR ä¸­è¯´æ˜ API å˜æ›´

- **å‰ç«¯å¼€å‘è€…**:
  - æ‹‰å–ä»£ç åè¿è¡Œ `pnpm generate` æ›´æ–°ç±»å‹
  - æ ¹æ® TypeScript é”™è¯¯æç¤ºä¿®æ”¹ä»£ç 
  - æµ‹è¯•æ‰€æœ‰å—å½±å“çš„åŠŸèƒ½

### 3. CI/CD é›†æˆ

```yaml
# .github/workflows/ci.yml
name: CI

on: [push, pull_request]

jobs:
  type-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: pnpm/action-setup@v2
      - name: Install dependencies
        run: pnpm install
      
      - name: Start backend
        run: cd apps/api && pnpm start:dev &
      
      - name: Generate types
        run: |
          cd packages/api-contract && pnpm generate
          cd ../types && pnpm generate
      
      - name: Type check
        run: pnpm turbo run build
```

---

### 4. æ€§èƒ½ä¼˜åŒ–

- **å¢é‡ç”Ÿæˆ**: åªåœ¨ API å˜æ›´æ—¶é‡æ–°ç”Ÿæˆç±»å‹
- **ç¼“å­˜ç­–ç•¥**: ä½¿ç”¨ Turborepo ç¼“å­˜æ„å»ºç»“æœ
- **æŒ‰éœ€å¯¼å…¥**: ä½¿ç”¨ `import type` é¿å…è¿è¡Œæ—¶å¼€é”€

```typescript
// âœ… æ¨èï¼šç±»å‹å¯¼å…¥
import type { components } from "@your-project/types";

// âŒ é¿å…ï¼šå€¼å¯¼å…¥ï¼ˆä¼šå¢åŠ  bundle å¤§å°ï¼‰
import { components } from "@your-project/types";
```

### 5. é”™è¯¯å¤„ç†

```typescript
// åç«¯ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼
export class ErrorResponseDto {
  @ApiProperty({ description: 'é”™è¯¯æ¶ˆæ¯' })
  message: string;

  @ApiProperty({ description: 'é”™è¯¯ç ' })
  code: string;

  @ApiProperty({ description: 'HTTP çŠ¶æ€ç ' })
  statusCode: number;
}

// åœ¨ Controller ä¸­ä½¿ç”¨
@ApiResponse({ status: 400, type: ErrorResponseDto })
@ApiResponse({ status: 404, type: ErrorResponseDto })
```

---

## å®æˆ˜æ¡ˆä¾‹ï¼šSpecMaster é¡¹ç›®

### é¡¹ç›®èƒŒæ™¯

- **é¡¹ç›®**: æœè£…é…æ–¹ç®¡ç†ç³»ç»Ÿ
- **æŠ€æœ¯æ ˆ**: NestJS + React + Prisma + PostgreSQL
- **æ•°æ®ç»“æ„**: 4 å±‚åµŒå¥—ï¼ˆStyle â†’ Variant â†’ BOM Item â†’ Spec Detailï¼‰
- **æ¨¡å—æ•°é‡**: 7 ä¸ªæ¨¡å—ï¼ˆStyles, Variants, BOM Items, Spec Details, Customers, Sizes, Unitsï¼‰

### è¿ç§»æˆæœ

- âœ… **21 ä¸ª DTO æ–‡ä»¶**å…¨éƒ¨è¿ç§»åˆ° camelCase
- âœ… **7 ä¸ª Service** ç§»é™¤æ‰‹åŠ¨è½¬æ¢é€»è¾‘
- âœ… **7 ä¸ª Controller** æ·»åŠ  Response DTO ç±»å‹
- âœ… **15 ä¸ªå‰ç«¯ç»„ä»¶**å®Œæˆç±»å‹è¿ç§»
- âœ… **407 ä¸ªå­—æ®µè®¿é—®**ä» snake_case æ›´æ–°ä¸º camelCase
- âœ… **0 TypeScript ç¼–è¯‘é”™è¯¯**
- âœ… **æ‰€æœ‰ CRUD æ“ä½œ**æµ‹è¯•é€šè¿‡

### å…³é”®ç»éªŒ

1. **åˆ†é˜¶æ®µè¿ç§»**: å…ˆåç«¯ï¼Œå†å‰ç«¯ï¼Œæœ€åæµ‹è¯•
2. **ä½¿ç”¨å·¥å…·**: åˆ©ç”¨ Task å·¥å…·æ‰¹é‡å¤„ç†é‡å¤æ€§å·¥ä½œ
3. **ç±»å‹æ¡¥æ¥**: ä½¿ç”¨ `legacy.ts` å¹³æ»‘è¿‡æ¸¡
4. **åµŒå¥—å…³ç³»**: æ˜ç¡®å®šä¹‰æ‰€æœ‰åµŒå¥—ç±»å‹ï¼Œé¿å… `any`
5. **æŒç»­éªŒè¯**: æ¯ä¸ªé˜¶æ®µéƒ½è¿è¡Œç¼–è¯‘æ£€æŸ¥

---

## å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£

- [NestJS Swagger](https://docs.nestjs.com/openapi/introduction)
- [OpenAPI Specification](https://swagger.io/specification/)
- [openapi-typescript](https://github.com/drwpow/openapi-typescript)
- [Prisma Client](https://www.prisma.io/docs/concepts/components/prisma-client)

### ç›¸å…³å·¥å…·

- [Swagger Editor](https://editor.swagger.io/) - åœ¨çº¿ç¼–è¾‘å’ŒéªŒè¯ OpenAPI è§„èŒƒ
- [Swagger UI](https://swagger.io/tools/swagger-ui/) - API æ–‡æ¡£å¯è§†åŒ–
- [Postman](https://www.postman.com/) - API æµ‹è¯•å·¥å…·ï¼ˆæ”¯æŒå¯¼å…¥ OpenAPI è§„èŒƒï¼‰

---

## æ€»ç»“

### æ ¸å¿ƒä¼˜åŠ¿

1. **ç±»å‹å®‰å…¨**: ç¼–è¯‘æ—¶å‘ç°é”™è¯¯ï¼Œè€Œéè¿è¡Œæ—¶
2. **è‡ªåŠ¨åŒ–**: å‡å°‘æ‰‹åŠ¨ç»´æŠ¤ç±»å‹å®šä¹‰çš„å·¥ä½œé‡
3. **æ–‡æ¡£åŒæ­¥**: API æ–‡æ¡£ä¸ä»£ç å§‹ç»ˆä¸€è‡´
4. **é‡æ„å‹å¥½**: å­—æ®µé‡å‘½åæ—¶ï¼Œæ‰€æœ‰å¼•ç”¨å¤„éƒ½ä¼šæŠ¥é”™æç¤º
5. **å›¢é˜Ÿåä½œ**: å‰åç«¯åŸºäºåŒä¸€ä»½ç±»å‹å®šä¹‰å·¥ä½œ

### æŠ•å…¥äº§å‡ºæ¯”

- **åˆæœŸæŠ•å…¥**: 1-2 å‘¨æ­å»ºåŸºç¡€è®¾æ–½
- **è¿ç§»æˆæœ¬**: æ ¹æ®é¡¹ç›®è§„æ¨¡ï¼Œ2-6 å‘¨
- **é•¿æœŸæ”¶ç›Š**: 
  - å‡å°‘ 30-50% çš„ç±»å‹ç›¸å…³ Bug
  - æå‡ 20-30% çš„å¼€å‘æ•ˆç‡
  - é™ä½ 40-60% çš„æ²Ÿé€šæˆæœ¬

### é€‚ç”¨å»ºè®®

- âœ… **å¼ºçƒˆæ¨è**: ä¸­å¤§å‹é¡¹ç›®ã€å¤šäººåä½œã€é¢‘ç¹è¿­ä»£
- âš ï¸ **è°¨æ…è¯„ä¼°**: å°å‹é¡¹ç›®ã€å•äººå¼€å‘ã€ç¨³å®šç»´æŠ¤
- âŒ **ä¸æ¨è**: åŸå‹éªŒè¯ã€ä¸€æ¬¡æ€§é¡¹ç›®ã€çº¯é™æ€é¡µé¢

---

## é™„å½•

### A. å®Œæ•´ç¤ºä¾‹ä»£ç 

å®Œæ•´çš„ç¤ºä¾‹ä»£ç å¯ä»¥å‚è€ƒ SpecMaster é¡¹ç›®ï¼š

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>

# æŸ¥çœ‹å…³é”®æ–‡ä»¶
- packages/api-contract/generate.sh
- packages/types/generate.sh
- apps/api/src/modules/styles/dto/style-response.dto.ts
- apps/web/src/types/legacy.ts
- apps/web/src/providers/apiDataProvider.ts
```

### B. å¿«é€Ÿå¯åŠ¨è„šæœ¬

```bash
#!/bin/bash
# quick-start.sh

echo "ğŸš€ Starting end-to-end type safety setup..."

# 1. å¯åŠ¨åç«¯
cd apps/api
pnpm start:dev &
API_PID=$!

# 2. ç­‰å¾…åç«¯å¯åŠ¨
sleep 5

# 3. ç”Ÿæˆç±»å‹
cd ../../packages/api-contract
pnpm generate

cd ../types
pnpm generate

# 4. å¯åŠ¨å‰ç«¯
cd ../../apps/web
pnpm dev

echo "âœ… Setup complete!"
echo "ğŸ“š API Docs: http://localhost:3000/docs"
echo "ğŸŒ Frontend: http://localhost:5173"
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2026-01-22  
**åŸºäºé¡¹ç›®**: SpecMaster (æœè£…é…æ–¹ç®¡ç†ç³»ç»Ÿ)

